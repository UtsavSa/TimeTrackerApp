<div class="p-6 space-y-6 text-gray-800 dark:text-gray-100">
  <!-- ğŸ§­ Sprint Selector & Controls -->
  <div class="flex items-center justify-between flex-wrap gap-4">
    <div class="flex items-center gap-3">
      <label class="text-sm font-medium">Sprint:</label>
      <select
        [(ngModel)]="selectedSprintId"
        (change)="onSprintChange(selectedSprintId)"
        class="rounded-full border px-4 py-2 text-sm bg-white dark:bg-gray-800 text-gray-800 dark:text-white border-gray-300 dark:border-gray-600 shadow-sm">
        <option value=""> ğŸŒ€ Unassigned</option>
        <option *ngFor="let sprint of sprints" [value]="sprint.id" [title]="sprint.name">
    ğŸ“ˆ {{ sprint.name  }}              
  </option>
      </select>
    </div>

    <div class="flex gap-2">
      <button
        *ngIf="isSprintCreator"
        (click)="deleteSprint()"
        class="bg-red-500 hover:bg-red-600 text-white text-sm px-4 py-2 rounded-full shadow-md">
        ğŸ—‘ï¸ Delete
      </button>
      <button
        (click)="creatingSprint = !creatingSprint"
        class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded-full shadow-md">
        {{ creatingSprint ? 'âœ– Cancel' : 'â• Create Sprint' }}
      </button>
    </div>
  </div>

  <!-- ğŸ“… Sprint Date Range & Progress -->
<div *ngIf="selectedSprint" class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl p-4 shadow-sm mt-3">
  <div class="flex flex-wrap items-center justify-between gap-3">
    <div class="text-sm">
      <div class="font-semibold text-gray-700 dark:text-gray-200">
        ğŸ“… {{ formatDate(selectedSprint.startDate) }} â†’ {{ formatDate(selectedSprint.endDate) }}
      </div>
      <div class="text-gray-600 dark:text-gray-400">
        {{ sprintDaysLeftText }}
      </div>
    </div>

    <div class="flex-1 min-w-[200px] max-w-[360px]">
      <div class="w-full h-2 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden">
        <div
          class="h-2 bg-indigo-600 dark:bg-indigo-500 rounded-full transition-all"
          [style.width.%]="sprintProgressPercent">
        </div>
      </div>
      <div class="text-right text-xs text-gray-500 dark:text-gray-400 mt-1">
        {{ sprintProgressPercent }}%
      </div>
    </div>
  </div>
</div>


  <!-- ğŸ‘¥ Sprint Members & Invite -->
  <div *ngIf="selectedSprint" class="space-y-2 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl p-4 shadow-sm">
    <div class="flex flex-wrap items-center gap-2 text-sm">
      <span class="font-semibold text-gray-700 dark:text-gray-200">ğŸ‘¥ Members:</span>
      <span
        *ngFor="let email of selectedSprintUserEmails"
        class="bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 px-2 py-1 rounded-full text-xs"
      >
        {{ email }}
      </span>
    </div>

    <div *ngIf="isSprintCreator" class="flex flex-col sm:flex-row gap-2 mt-2">
      <input
        type="email"
        [(ngModel)]="inviteEmail"
        placeholder="Invite user by email"
        class="flex-1 px-3 py-2 rounded-full border text-sm shadow-sm dark:bg-gray-800 dark:text-white dark:border-gray-600"
      />
      <button
        (click)="inviteUserToSprint()"
        class="bg-purple-600 hover:bg-purple-700 text-white text-sm px-4 py-2 rounded-full shadow-md"
      >
        âœ‰ï¸ Invite
      </button>
    </div>
  </div>

  <!-- ğŸ“… Create Sprint Form 
  <div *ngIf="creatingSprint" class="grid grid-cols-1 sm:grid-cols-3 gap-4">
    
    <input
  type="text"
  [(ngModel)]="newSprint.name"
  (ngModelChange)="onSprintNameInput()"             
  [attr.maxlength]="MAX_SPRINT_NAME"               
  placeholder="ğŸ Sprint Name"
  class="rounded-full px-4 py-2 text-sm border dark:bg-gray-800 dark:border-gray-600 shadow-sm"
/>
<div class="text-xs text-right mt-1"
     [ngClass]="{
       'text-red-600': (newSprint.name?.length || 0) > MAX_SPRINT_NAME,
       'text-yellow-600': (newSprint.name?.length || 0) > NAME_WARN_THRESHOLD
     }">
  {{ (newSprint.name?.length || 0) }}/{{ MAX_SPRINT_NAME }}
</div>
      <input type="date" [(ngModel)]="newSprint.startDate"
      class="rounded-full px-4 py-2 text-sm border dark:bg-gray-800 dark:border-gray-600 shadow-sm" />
    <input type="date" [(ngModel)]="newSprint.endDate"
      class="rounded-full px-4 py-2 text-sm border dark:bg-gray-800 dark:border-gray-600 shadow-sm" />
    <button
      (click)="createSprint()"
      class="col-span-1 sm:col-span-3 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-full shadow-md">
      âœ… Create Sprint
    </button>
  </div>
-->


  <!-- ğŸ“… Create Sprint Form -->
<div *ngIf="creatingSprint" class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-2xl p-5 shadow-sm">
  <form class="grid grid-cols-1 sm:grid-cols-3 gap-4" (ngSubmit)="createSprint()">
    <!-- Name -->
    <div class="sm:col-span-3">
      <label class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">
        ğŸ Sprint name
        <span class="text-xs text-gray-500">(max {{ MAX_SPRINT_NAME }})</span>
      </label>

      <div class="relative">
        <input
          type="text"
          [(ngModel)]="newSprint.name"
          name="sprintName"
          (ngModelChange)="onSprintNameInput()"
          [attr.maxlength]="MAX_SPRINT_NAME"
          placeholder="For e.g., Frontend Work â€“ Sprint 14"
          class="w-full rounded-full px-4 pr-14 py-2 text-sm border dark:bg-gray-800 dark:border-gray-600 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
        />
        <!-- live counter badge -->
        <span
          class="absolute right-3 top-1/2 -translate-y-1/2 text-xs px-2 py-0.5 rounded-full border"
          [ngClass]="{
            'text-gray-500 border-gray-300 dark:text-gray-300 dark:border-gray-600': nameLen <= NAME_WARN_THRESHOLD,
            'text-yellow-700 bg-yellow-100 border-yellow-300 dark:text-yellow-200 dark:bg-yellow-700/30 dark:border-yellow-600': nameLen > NAME_WARN_THRESHOLD && nameLen <= MAX_SPRINT_NAME,
            'text-red-700 bg-red-100 border-red-300 dark:text-red-200 dark:bg-red-700/30 dark:border-red-600': nameLen > MAX_SPRINT_NAME
          }">
          {{ nameLen }}/{{ MAX_SPRINT_NAME }}
        </span>
      </div>

      
      <p *ngIf="nameLen > MAX_SPRINT_NAME" class="mt-1 text-xs text-red-600">
        Sprint name is too long.
      </p>
    </div>

    <!-- Dates row: start on the left, end on the right -->
<div class="sm:col-span-3">
  <div class="flex flex-col sm:flex-row sm:items-end sm:gap-4">
    <!-- Start date (left) -->
    <div class="w-full sm:max-w-xs">
      <label class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">Start date</label>
      <input
        type="date"
        [(ngModel)]="newSprint.startDate"
        name="startDate"
        [attr.min]="todayStr"
        class="w-full rounded-full px-4 py-2 text-sm border dark:bg-gray-800 dark:border-gray-600 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
      />
      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Canâ€™t start in the past.</p>
    </div>

    <!-- End date (right) -->
    <div class="w-full sm:max-w-xs sm:ml-auto">
      <label class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">End date</label>
      <input
        type="date"
        [(ngModel)]="newSprint.endDate"
        name="endDate"
        [attr.min]="newSprint.startDate || todayStr"
        class="w-full rounded-full px-4 py-2 text-sm border dark:bg-gray-800 dark:border-gray-600 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
      />
      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Must be on/after the start date.</p>
      <p
        *ngIf="newSprint.startDate && newSprint.endDate && newSprint.endDate < newSprint.startDate"
        class="mt-1 text-xs text-red-600"
      >
        End date cannot be before the start date.
      </p>
    </div>
  </div>
</div>


    <!-- Spacer for grid alignment -->
    <div class="hidden sm:block"></div>

    <!-- Actions -->
    <div class="sm:col-span-3 flex flex-col sm:flex-row items-stretch sm:items-center gap-2 justify-end mt-2">
      <button
        type="button"
        (click)="creatingSprint = false"
        class="inline-flex items-center justify-center gap-2 px-4 py-2 rounded-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700"
      >
        <ng-icon name="lucideX" class="w-4 h-4"></ng-icon>
        Cancel
      </button>

      <button
        type="submit"
        [disabled]="
          savingSprint ||
          !(newSprint.name && newSprint.startDate && newSprint.endDate) ||
          nameLen > MAX_SPRINT_NAME ||
          (newSprint.startDate && newSprint.endDate && newSprint.endDate < newSprint.startDate)
        "
        class="inline-flex items-center justify-center gap-2 px-5 py-2 rounded-full bg-green-600 hover:bg-green-700 text-white text-sm shadow-md disabled:opacity-60 disabled:cursor-not-allowed"
      >
        <ng-icon *ngIf="!savingSprint" name="lucideCheck" class="w-4 h-4"></ng-icon>
        <ng-icon *ngIf="savingSprint" name="lucideLoader" class="w-4 h-4 animate-spin"></ng-icon>
        {{ savingSprint ? 'Creatingâ€¦' : 'Create Sprint' }}
      </button>
    </div>
  </form>
</div>


  <!-- ğŸ—‚ï¸ Task Board -->
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mt-6">
    <div *ngFor="let status of taskStatuses" class="bg-gray-100 dark:bg-gray-800 rounded-2xl p-4 shadow-inner">
      <!-- Column Header -->
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-bold">
          {{ status === 'todo' ? 'ğŸ“ To Do' : status === 'in-progress' ? 'ğŸ”„ In Progress' : 'âœ… Done' }}
        </h2>
        <button
          (click)="showAddTaskPopover(status)"
          class="text-xl hover:scale-110 transition rounded-full bg-white dark:bg-gray-700 w-8 h-8 flex items-center justify-center shadow-sm"
          aria-label="Add Task"
        >â•</button>
      </div>

      <!-- Add Task Popover -->
      <app-add-task-popover
        *ngIf="addTaskStatus === status"
        [status]="status"
        (close)="addTaskStatus = null"
        (create)="handleNewTask($event)">
      </app-add-task-popover>

      <!-- Task Cards -->
      <div *ngFor="let task of getTasksByStatus(status)">
        <div
          class="relative bg-white dark:bg-gray-700 p-4 mb-4 rounded-2xl shadow group cursor-pointer transition hover:ring-2 hover:ring-indigo-400"
          (click)="openTask(task)"
        >

          <!-- Delete Icon -->
          <button
            (click)="deleteTask(task); $event.stopPropagation()"
            class="absolute top-2 right-2 text-gray-400 hover:text-red-500 transition text-sm"
            title="Delete Task"
          >ğŸ—‘ï¸</button>

          <!-- Status Badge -->
          <div class="mb-3">
            <span
              [ngClass]="{
                'bg-yellow-200 text-yellow-900 border-yellow-300': task.status === 'todo',
                'bg-blue-200 text-blue-900 border-blue-300': task.status === 'in-progress',
                'bg-green-200 text-green-900 border-green-300': task.status === 'done'
              }"
              class="text-sm font-semibold px-3 py-1 rounded-full border shadow-sm inline-flex items-center gap-1"
            >
              {{ task.status === 'todo' ? 'ğŸ“ To Do' : task.status === 'in-progress' ? 'ğŸ”„ In Progress' : 'âœ… Done' }}
            </span>
          </div>

          <!-- Title -->
          <h4 class="text-md font-semibold mb-1">{{ task.name }}</h4>

          <!-- Description -->
          <p class="text-sm text-gray-600 dark:text-gray-300 mb-2 truncate">
            {{ task.description || 'No description provided' }}
          </p>

          <!-- Metrics -->
          <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">
            ğŸ¯ {{ task.storyPoints }} pts â€¢ â± {{ task.hoursTaken }}/{{ task.hoursNeeded }} hrs
          </div>

          <!-- Hours Input -->
          <div class="mb-2">
            <label class="text-xs">Hours Taken:</label>
            <input
              type="number"
              min="0"
              [max]="task.hoursNeeded"
              [(ngModel)]="task.hoursTaken"
              (change)="updateTaskHours(task)"
              (click)="$event.stopPropagation()"
              class="w-20 px-2 py-1 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-600 dark:text-white shadow-sm"
            />
          </div>

          <!-- Status Actions -->
          <div class="flex flex-wrap gap-2 mt-3">
            <button
              *ngFor="let s of taskStatuses"
              (click)="updateStatus(task, s); $event.stopPropagation()"
              [ngClass]="{
                'bg-indigo-600 text-white': task.status === s,
                'bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200': task.status !== s
              }"
              class="px-4 py-2 text-sm font-medium rounded-full transition hover:scale-105 shadow-sm"
            >
              {{ s === 'todo' ? 'ğŸ“ To Do' : s === 'in-progress' ? 'ğŸ”„ In Progress' : 'âœ… Done' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ğŸ” Task Details Modal -->
  <app-task-details
    *ngIf="selectedTask"
    [task]="selectedTask"
    (close)="closeTaskDetails()"
    (delete)="deleteTask(selectedTask!)"
    (statusChange)="updateStatus($event.task, $event.status)"
  ></app-task-details>
</div>
